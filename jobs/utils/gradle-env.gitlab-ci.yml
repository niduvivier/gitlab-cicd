---

# This job template is to be used with each gradle command to set the proxy event correctly.
# Note that project may still contain a ci/gradle.properties file, these are ignored from now on
# it defaults to the gitlab ci user and job token, which is actually the same as default
# repository clone origin url in CI jobs.
#
# Other user and private token can be assigned to teh variables GITLAB_USERNAME and GITLAB_USERAUTH
# to change this behaviour
#
# This job template is ment to be included and extended as part of another job
# eg.:
#  include:
#    - project: automation/cicd/templates
#     ref: ${latest project version}
#      ref: ${project latest version}
#      file: utils/gradle-env.gitlab-ci.yml
#  job1:
#    extends: .gradle-env
#    script:
#      - /bin/true

.gradle-env:
  before_script:
    - |
      cat > ./gradle.properties <<- EOF
      # generated by /automation/cicd/templates/jobs/utils/gradle-env.yml
      #
      systemProp.http.proxyHost=${PROXY_HOST}
      systemProp.http.proxyPort=${PROXY_PORT}
      systemProp.http.nonProxyHosts=${NON_PROXY_HOSTS}
      systemProp.https.proxyHost=${PROXY_HOST}
      systemProp.https.proxyPort=8080
      systemProp.https.nonProxyHosts=${NON_PROXY_HOSTS}
      systemProp.sonar.host.url=${SONAR_URL}

      org.gradle.daemon=false
      org.gradle.jvmargs=-XX:MaxMetaspaceSize=512m
      EOF

