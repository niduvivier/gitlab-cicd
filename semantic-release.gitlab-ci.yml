---

include: gitlab-http-access.gitlab-ci.yml

# Use this job template to provide automated samentic version tags and gitlab releases
# for you projects
#
# Use this job template by including this file from the project
# and defining the release stage
#
# eg.:
# include:
#   - project: automation/cicd/templates
#     version: ${latest project release version}
#     file: semantic-release.gitlab-ci.yml  
# stages:
#   - release

semantic-release:
  variables:
    SEMANTIC_RELEASE_USER: semantic-release-bot
    SEMANTIC_RELEASE_AUTH: ${SEMANTICRELEASE_TOKEN}
    GITLAB_USERNAME: ${SEMANTIC_RELEASE_USER}
    GITLAB_USERAUTH: ${SEMANTIC_RELEASE_AUTH}
  extends:
    - .gitlab_http_access
  image: $REGISTRY/semantic-release:v1.3.6@sha256:5a015b5e8802b3e2923c8bbc6913b90ea0adaaca91c0036f6ca835dd7f03ee93
  stage: release
  script:
    - GL_TOKEN=${SEMANTICRELEASE_TOKEN} semantic-release --extends @enttribe/semantic-release-config --repository-url "${GITLAB_AUTHENTICATED_REPO_URL}"
  rules:
    - if: $CI_DEFAULT_BRANCH == $CI_COMMIT_BRANCH

...
